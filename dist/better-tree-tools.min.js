!function(t,e){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&module.exports?module.exports=e():(t="undefined"!=typeof globalThis?globalThis:t).BetterTreeTools=e()}(this,function(){function t(t){this.config=Object.assign({id:"id",pId:"pId",children:"children"},t)}return t.prototype={typeIs:function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},listToTree:function(t){var e=this.config,r=e.id,i=e.pId,n=e.children,o=[];if("array"!==this.typeIs(t))return o;t.forEach(function(t){delete t[n]});var s={};return t.forEach(function(t){s[t[r]]=t}),t.forEach(function(t){var e=s[t[i]];(e?e[n]||(e[n]=[]):o).push(t)}),o},treeToList:function(t){var s=this,f=[],h=this.config.children;return function t(e){if("array"!==s.typeIs(e))f.push(e);else for(var r=0,i=e.length;r<i;r++){var n=e[r],o=JSON.parse(JSON.stringify(n[h]||"[]"));"array"===s.typeIs(n[h])?(delete n[h],f.push(n),t(o)):f.push(n)}}(t),f},getNode:function(t,e){var o=this,r=0<arguments.length&&void 0!==t?t:[],s=e,i=this.config,f=i.id,h=i.children;return function t(e){for(var r=0,i=e.length;r<i;r++){var n=e[r];if(n[f]===s)return n;"array"===o.typeIs(n[h])&&(delete n[h],t(n[h]))}}(r)},getNodeList:function(t,e){var s=this,r=0<arguments.length&&void 0!==t?t:[],i=1<arguments.length&&void 0!==e?e:{},n=this.config,f=n.id,h=n.pId,d=n.children,u=i[f],c=i[h],a=[];return function t(e){for(var r=0,i=e.length;r<i;r++){var n,o=e[r];o[f]!==u&&o[h]!==c||a.push(o),"array"===s.typeIs(o[d])&&(n=JSON.parse(JSON.stringify(o[d])),delete o[d],t(n))}}(r),a},removeNode:function(t,e){for(var r=0<arguments.length&&void 0!==t?t:[],i=1<arguments.length&&void 0!==e?e:{},n=this.config,o=n.id,s=n.pId,f=i[o],h=i[s],d=this.treeToList(r),u=0,c=d.length;u<c;u++){var a=d[u];a&&(a[o]!==f&&a[s]!==h||(delete d[u],--u))}return this.listToTree(d)},insert:function(t,e,r){for(var i=this.treeToList(t),n=0,o=i.length;n<o;n++)i[n].sort=n;r=this.getNode(i,r);r&&(e.pId=r.id,e.sort=r.sort-1),i.push(e);e=this.listToTree(i);return this.sort(e)},sort:function(t){var r=this,i=this.config.children;return function e(t){t=t.sort(function(t,e){return t.sort-e.sort});t.length&&t.forEach(function(t){"array"===r.typeIs(t[i])&&e(t[i])})}(t),t}},t});