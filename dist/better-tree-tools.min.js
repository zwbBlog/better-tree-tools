var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _defineProperty(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}!function(t,e){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&module.exports?module.exports=e():(t="undefined"!=typeof globalThis?globalThis:t).BetterTreeTools=e()}(this,function(){function t(t){this.config=Object.assign({id:"id",pId:"pId",children:"children"},t)}return t.prototype={typeIs:function(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()},deepCopy:function(t){var r=this,n="array"===this.typeIs(t)?[]:{},o=["array","object"];if(!o.includes(this.typeIs(t)))return t;return function(t){for(var e in t)t.hasOwnProperty(e)&&("object"===_typeof(t[e])&&o.includes(r.typeIs(t[e]))?n[e]=r.deepCopy(t[e]):n[e]=t[e])}(t),n},listToTree:function(t){var e=this.config,r=e.id,n=e.pId,o=e.children,i=[];if("array"!==this.typeIs(t))return i;t.forEach(function(t){delete t[o]});var f={};return t.forEach(function(t){f[t[r]]=t}),t.forEach(function(t){var e=f[t[n]];(e?e[o]||(e[o]=[]):i).push(t)}),i},listFastToTree:function(t){var e=this.config,r=e.id,n=e.pId,o=e.children,i={},f="_$null",s=!0,u=!1,a=void 0;try{for(var l=t[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var c=h.value,d=c[r],h=c[n];i[d]||(i[d]=_defineProperty({},o,[])),i[d]=Object.assign(c,_defineProperty({},o,i[d][o])),i[h=h||f]||(i[h]=_defineProperty({},o,[])),i[h][o].push(i[d])}}catch(t){u=!0,a=t}finally{try{!s&&l.return&&l.return()}finally{if(u)throw a}}var y=i[f],e=i[0];if(y&&e){if(y[r]&&!e[r])return e[o];if(e[r]&&!y[r])return y[o];if(!y[r]&&!e[r])return[].concat(_toConsumableArray(y[o]),_toConsumableArray(e[o]))}return y?y[o]:e?e[o]:void 0},treeToList:function(t){function f(e){0===r.filter(function(t){return t[n]===e[n]}).length&&r.push(e)}var s=this,r=[],e=this.config,u=e.children,n=e.id,t=this.deepCopy(t);return function t(e){if("array"!==s.typeIs(e))f(e);else for(var r=0,n=e.length;r<n;r++){var o,i=e[r];i[u]&&"array"===s.typeIs(i[u])?(o=s.deepCopy(i[u]),delete i[u],f(i),t(o)):f(i)}}(t),r},getNode:function(t,e){for(var r=0<arguments.length&&void 0!==t?t:[],n=e,r=this.deepCopy(r),o=this.config.id,i=this.treeToList(r),f=0,s=i.length;f<s;f++){var u=i[f];if(u[o]===n)return u}return null},getNodeList:function(t,e){for(var r=0<arguments.length&&void 0!==t?t:[],n=1<arguments.length&&void 0!==e?e:{},o=this.deepCopy(r),r=this.config,i=r.id,f=r.pId,s=n[i],u=n[f],a=[],l=this.treeToList(o),c=0,d=l.length;c<d;c++){var h=l[c];h[i]!==s&&h[f]!==u||a.push(h)}return a},removeNode:function(t,e){for(var r=0<arguments.length&&void 0!==t?t:[],n=1<arguments.length&&void 0!==e?e:{},o=this.config,i=o.id,f=o.pId,s=n[i],u=n[f],a=this.treeToList(r),l=0,c=a.length;l<c;l++){var d=a[l];d&&(d[i]!==s&&d[f]!==u||(delete a[l],--l))}return this.listToTree(a)},insert:function(t,e){for(var r=this.treeToList(t),n=0,o=r.length;n<o;n++)r[n].sort=n;t=this.getNode(r,e.pId);t&&(e.pId=t.id,e.sort=t.sort-1),r.push(e);e=this.listToTree(r);return this.sort(e)},sort:function(t){var r=this,n=this.config.children;return function e(t){t=t.sort(function(t,e){return t.sort-e.sort});t.length&&t.forEach(function(t){"array"===r.typeIs(t[n])&&e(t[n])})}(t),t}},t});